<!DOCTYPE html>
<html lang="en">

<head>
    <title>爱趣洗</title>

    <meta charset="UTF-8">
    <!-- 设置窗口自适应手机 -->
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">

    <!--苹果手机适配-->
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">

    <!--TODO：1. 这是啥？-->
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">

    <!--引入css以及js文件-->
    <link href="css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="dist/idangerous.swiper.css">
    <!--Html5手机触摸左右滑动插件,触屏幻灯片图片切换插件-->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!--一套绝佳的图标字体库和CSS框架-->
    <link rel="stylesheet" href="css/base.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="dist/idangerous.swiper.min.js"></script>
    <script src="js/common.js"></script>
</head>

<body>
    <div id="main">

        <!--主图-->
        <section id="banner_top">
            <div class="device">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/banner/slider1-1.jpg"></div>
                        <!--<div class="swiper-slide"><imgs src="http://iquxi.oss-cn-shanghai.aliyuncs.com/banner/slider1-2.png"></div>-->
                        <!--<div class="swiper-slide"><imgs src="http://iquxi.oss-cn-shanghai.aliyuncs.com/banner/slider1-3.png"></div>-->
                        <!--<div class="swiper-slide">-->
                        <!--<div class="content-slide" style="background-color: darkgray;margin: 20px;opacity: 0.5">-->
                        <!--<p class="title">Slide with HTML</p>-->

                        <!--<p>You can put any HTML inside of slide with any layout, not only images, even another-->
                        <!--Swiper!</p>-->
                        <!--</div>-->
                        <!--</div>-->
                    </div>
                </div>
                <div class="pagination"></div>
            </div>
        </section>

        <!--用户所在服务区域-->
        <div class="location">
            <a class="city"><span class="em"></span></a>
        </div>

        <!--洗衣类别-->
        <section id="washing-category">

            <p class="stitle"> — 专业清洗 — </p>

            <div class="border_b"></div>
            <div class="div_block">

                <div data-link="">

                    <a href="category.html?category_id=1">
                        <p> 洗衣</p>
                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/xiyi.png">
                    </a>

                </div>
                <div>
                    <a href="category.html?category_id=2">

                        <p>洗鞋</p>
                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/xixie.png">
                    </a>

                </div>
                <div>
                    <a href="category.html?category_id=3">

                        <p>洗家纺</p>
                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/xijiafang.png">
                    </a>
                </div>
                <div>
                    <a href="category.html?category_id=4">

                        <p>窗帘清洗</p>
                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/xichaunglian.png">
                    </a>
                </div>

            </div>

        </section>
        <!--中间广告位-->
        <div class="mid-banner">
            <a href="hongbao.html">
                <img width="100%" height="50px" src="http://iquxi.oss-cn-shanghai.aliyuncs.com/banner/banner_hongbao.jpg">

            </a>
        </div>
        <!--高端洗护 -->
        <section id="luxury-category">

            <p class="stitle">— 高端洗护 —</p>
            <div class="border_b"></div>
            <div class="luxury_block">
                <div data-link="category.html?category_id=4">
                    <!-- TODO: 为什么只在这里设置了-->
                    <span class="luxury_text_left"> 奢侈品养护</span>
                </div>
                <div data-link="">
                    <img class="luxury_open" src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/shechipin.png" name="leather">
                </div>
                <div>
                    <img class="luxury_open" src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/jiafang.png" name="clothes">
                </div>
                <div>
                    <span class="luxury_text_right">高端成衣家纺</span>
                </div>
            </div>

        </section>

        <!--服务类型-->
        <section id="service">
            <div class="service_block">
                <div>
                    <a href="#" title="">

                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/s1.png" alt="">
                    </a>

                    <p class="title-ff7c3c">服务介绍</p>
                </div>


                <div>
                    <a href="#" title="">

                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/s2.png" alt="">
                    </a>

                    <p class="title-ff7c3c">服务范围</p>
                </div>


                <div>
                    <a href="price.html" title="">

                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/s3.png" alt="">
                    </a>

                    <p class="title-ff7c3c">价目中心</p>
                </div>


                <div>
                    <a href="comment.html" title="">

                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/s4.png" alt="">
                    </a>

                    <p class="title-ff7c3c">意见反馈</p>
                </div>


                <div>
                    <a href="https://www.wjx.top/jq/19991354.aspx" title="">
                        <img src="http://iquxi.oss-cn-shanghai.aliyuncs.com/img/s5.png" alt="">
                    </a>

                    <p class="title-ff7c3c">团体洗衣</p>
                </div>


            </div>
        </section>

        <!--评价-->
        <section id="comments">
            <div class="myCommentSwiper-device">
                <div class="comment-swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="content-slide" style="background-color: darkgray;margin:0 20px;opacity: 0.5;height: 130px">
                                <p class="title">Slide with HTML</p>

                                <p>You can put any HTML inside of slide with any layout, not only images, even another Swiper!
                                </p>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="content-slide" style="background-color: darkgray;margin:0 20px;opacity: 0.5;height: 130px">
                                <p class="title">Slide with HTML</p>

                                <p>You can put any HTML inside of slide with any layout, not only images, even another Swiper!
                                </p>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="content-slide" style="background-color: darkgray;margin: 0 20px;opacity: 0.5;height: 130px">
                                <p class="title">Slide with HTML</p>

                                <p>You can put any HTML inside of slide with any layout, not only images, even another Swiper!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <a class="comment-more"> 《更多评价</a>
        </section>
        <!--TODO: 2.这是啥-->
        <section id="boot" style="height: 48px"></section>

        <!--底部-->
        <footer>
            <div class="indexMsg">
                <div class="indexMenu">
                    <a href="index.html">
                        <span class="foot home">首页</span>
                    </a>
                    <a href="order.html"><span class="foot order">订单</span></a>
                    <a href="mine.html">
                        <span class="foot mine">我的</span>
                    </a>
                </div>


            </div>
        </footer>
    </div>
</body>
<script type="text/javascript" src="./script/api.js"></script>
<script>
    var UICityList; //使用城市列表模块
    var baiduMap; //使用百度地图模块
    if (localStorage.currentCity != "undefined") //如果本地已经存储了当前城市，那么直接设置城市栏
    {
        $('.city').html(localStorage.currentCity + "<span class=\"em\"></span>");
    }

    apiready = function() {
        UICityList = api.require("UICityList");
        baiduMap = api.require('bMap');
        baiduMap.getLocation({
            accuracy: '10m',
            filter: 1,
            autoStop: true
        }, function(ret, err) {
            if (ret.status) {
                //console.log(JSON.stringify(ret));   //获取经纬度
                baiduMap.getNameFromCoords({
                    lon: ret.lon,
                    lat: ret.lat
                }, function(ret2, err2) {
                    if (ret2.status) {
                        localStorage.GPSAddress = ret2.address;
                        console.log(localStorage.GPSAddress);
                        localStorage.GPSCity = ret2.city.replace(/市/, ""); //去除末尾的市
                        if (localStorage.currentCity == "undefined") { //如果当前还没有设置城市，则直接设置为定位城市
                            localStorage.currentCity = localStorage.GPSCity;
                            $('.city').html(localStorage.currentCity + "<span class=\"em\"></span>");
                        }
                        if (localStorage.currentCity != localStorage.GPSCity) {
                            if (confirm("当前所选城市与定位城市不一致，是否切换到定位城市？")) {
                                localStorage.currentCity = localStorage.GPSCity;
                                $('.city').html(localStorage.currentCity + "<span class=\"em\"></span>");
                            }
                        }

                    }
                });
            } else {
                //alert(JSON.stringify(err));
            }
        });
    }

    function fnClose() {
        UICityList.close();
    }

    function fnShow() {
        UICityList.show();
    }

    function fnHide() {
        UICityList.hide();
    }

    function fnOpen() {
        UICityList.open({
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            },
            resource: 'widget://res/UICityList.json',
            styles: {
                searchBar: {
                    bgColor: '#E8E8E8',
                    cancColor: '#E3E3E3'
                },
                location: {
                    color: '#7AC5CD',
                },
                sectionTitle: {
                    bgColor: '#FFFFFF',
                },
                item: {
                    bgColor: '#FFFFFF',
                },
                indicator: {
                    bgColor: '#FFFFFF',
                }
            },
            currentCity: localStorage.GPSCity, //GPS定位城市设置为定位城市
        }, function(ret, err) {
            if (ret) {
                if (ret.eventType == 'selected') {
                    localStorage.currentCity = ret.cityInfo.city;
                    localStorage.currentCityId = ret.cityInfo.id;
                    $('.city').html(localStorage.currentCity + "<span class=\"em\"></span>");
                    UICityList.close();
                }
            } else {
                //  alert(JSON.stringify(err));
            }
        });
    }
    $('.location').click(fnOpen);
    $('.luxury_open').on('click', function(e) {
        api.openWin({
            name: 'MyNewIndex',
            url: 'MyNewIndex.html',
            rect: {
                x: 0,
                y: 0,
                w: 'auto',
                h: 'auto'

            },
            pageParam: {
                name: $(this).attr("name")
            },
            bounces: true,
            bgColor: 'rgba(255,255,255,1)',
            vScrollBarEnabled: true,
            hScrollBarEnabled: true,
            bounces:false
        });


    });
    var mySwiper = new Swiper('.swiper-container', {
        pagination: '.pagination',
        loop: true,
        grabCursor: true,
        paginationClickable: true //分页是否可点击
    })


    var myCommentSwiper = new Swiper('.comment-swiper-container', {
        loop: true,
        grabCursor: true,
        paginationClickable: true
    })
    $('.arrow-left').on('click', function(e) {
        e.preventDefault()
        myCommentSwiper.swipePrev()
    })
    $('.arrow-right').on('click', function(e) {
        e.preventDefault()
        myCommentSwiper.swipeNext()
    })
</script>

<script>
    function getSearchParams() {
        var params = {};
        var chunks = location.search.substr(1).split(/&/g);
        for (var i = 0; i < chunks.length; i++) {
            try {
                var items = chunks[i].split('=', 2);
                var key = items[0];
                params[key] = decodeURIComponent(items[1]);
            } catch (ex) {}
        }
        return params;
    }

    var param = getSearchParams()
    var submit_data = {
        code: param.code
    }
    console.log(param)
    var params = {
        url: 'api/wx/token/get',
        type: 'post',
        data: submit_data,
        tokenFlag: false,
        sCallback: function(res) {
            if (res) {
                console.log(res)
                window.base.setLocalStorage("token", res.token)
                window.base.setLocalStorage("account", res.mobile)
            } else {
                console.log("登陆失败")
            }
        },
        eCallback: function(e) {
            //     showTip(e)
        }
    };
    window.base.getData(params);
</script>

</html>
