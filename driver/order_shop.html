<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="email=no" name="format-detection">
    <title>取商家件</title>
    <link rel="stylesheet" href="css/idangerous.swiper.css">
    <link rel="stylesheet" href="css/idangerous.swiper.scrollbar.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/simple-app.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/order.css">
    <script src="js/zepto.js"></script>
    <script src="js/template.js"></script>
    <script src="js/common.js"></script>
</head>
<body>
<div class="main">
    <div class="swiper-nav swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><span>未取</span></div>
            <div class="swiper-slide"><span>未交</span></div>
            <div class="swiper-slide"><span>已交</span></div>
        </div>
    </div>

    <div class="swiper-pages swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="swiper-container scroll-container">
                    <div class="swiper-scrollbar"></div>
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="page-inner">
                                <div id="order_weiqu">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-container scroll-container">
                    <div class="swiper-scrollbar"></div>
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="page-inner">
                                <div id="order_yiqu">


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-container scroll-container">
                    <div class="swiper-scrollbar"></div>
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="page-inner">
                                <div id="order_yijiao">


                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <script src="js/jquery.min.js"></script>
        <!-- Don't forget to get the latest Swiper and scrollbar version here-->
        <script src="js/idangerous.swiper-2.0.min.js"></script>
        <script src="js/idangerous.swiper.scrollbar-2.0.js"></script>
        <script src="js/simple-app.js"></script>
<script>

    var token =window.base.getLocalStorage("drtoken")
    if(!token){
        window.location.href="login.html"
    }
    function deliverycome(id) {
        var deliverytodata={"id":id}
        var getdata = {
            url: 'del/order/merchant/send',
            type: 'post',
            data: deliverytodata,
            tokenFlag: true,
            sCallback: function (res) {
                if (res.msg == "ok") {
                    alert("已确认接单")
                    window.location.reload(true)
                } else {
                    alert(res.msg)
                }
            },
            eCallback: function (e) {
                //  showTip(e)
            }
        };
        window.base.getData(getdata);
    }


    function deliveryto(id) {
        var deliverytodata={"id":id}
        var getdata = {
            url: 'del/order/finish',
            type: 'post',
            data: deliverytodata,
            tokenFlag: true,
            sCallback: function (res) {
                if (res.msg == "ok") {
                    alert("已确认送达")
                    window.location.reload(true)
                } else {
                    alert(res.msg)
                }
            },
            eCallback: function (e) {
                //  showTip(e)
            }
        };
        window.base.getData(getdata);
    }
</script>
        <script id="order_weiqu_tem" type="text/html">
            {{each datas as item index}}
            {{ if item.status.id == 7}}
            <div class="order_box">
                <p>订单编号：{{item.order_no}}</p>
                <p>订单价格：￥{{item.total_price}} 元</p>
                <p>预约时间：{{item.time}}</p>
                <p>客户姓名：{{item.snap_address.name}}</p>
                <p>客户电话：{{item.snap_address.mobile}}</p>
                <p>客户地址：{{item.snap_address.city+item.snap_address.county+item.snap_address.detail}}</p>
                <p>物流状态：{{item.status.status}}</p>
                <div class="btn_area">
                <button class="btn btn-default btn_order" onclick="deliverycome('{{item.id}}')">确认接单</button>
                </div>
            </div>
            {{/if}}
            {{/each}}
        </script>

        <script id="order_yiqu_tem" type="text/html">
            {{each datas as item index}}
            {{ if item.status.id == 8}}
            <div class="order_box">
                <p>订单编号：{{item.order_no}}</p>
                <p>订单价格：￥{{item.total_price}} 元</p>
                <p>预约时间：{{item.time}}</p>
                <p>客户姓名：{{item.snap_address.name}}</p>
                <p>客户电话：{{item.snap_address.mobile}}</p>
                <p>客户地址：{{item.snap_address.city+item.snap_address.county+item.snap_address.detail}}</p>
                <p>物流状态：{{item.status.status}}</p>
                <div class="btn_area">
                <button class="btn btn-default btn_order" onclick="deliveryto('{{item.id}}')">确认送达</button>
                    <a class="btn btn-default btn_order" href="{{item.snap_address.mobile}}">拨打电话</a></div>
                    </div>
            </div>
            {{/if}}
            {{/each}}
        </script>

        <script id="order_yijiao_tem" type="text/html">
            {{each datas as item index}}
            {{if item.status.id== 9}}
            <div class="order_box">
                <p>订单编号：{{item.order_no}}</p>
                <p>订单价格：￥{{item.total_price}} 元</p>
                <p>预约时间：{{item.time}}</p>
                <p>客户姓名：{{item.snap_address.name}}</p>
                <p>客户电话：{{item.snap_address.mobile}}</p>
                <p>客户地址：{{item.snap_address.city+item.snap_address.county+item.snap_address.detail}}</p>
                <p>物流状态：{{item.status.status}}</p>
            </div>
            {{/if}}
            {{/each}}
        </script>

        <script>
            var getdata = {
                url: 'del/order/delivery/all',
                type: 'post',
                data: "",
                tokenFlag: true,
                sCallback: function (res) {
                    if (res.msg == undefined) {
                        console.log(res)
                        window.base.setLocalStorage("orderinfo",res)
                        var order_weiqu_html = template("order_weiqu_tem", {"datas":res})
                        $("#order_weiqu").html(order_weiqu_html)
                        var order_yiqu_html = template("order_yiqu_tem", {"datas":res})
                        $("#order_yiqu").html(order_yiqu_html)
                        var order_yijiao_html = template("order_yijiao_tem", {"datas":res})
                        $("#order_yijiao").html(order_yijiao_html)
                    } else {
                        alert(res.msg)
                    }
                },
                eCallback: function (e) {
                    //  showTip(e)
                }
            };
            window.base.getData(getdata);
        </script>

    </div>
</body>
</html>